---
import { Icon } from 'astro-icon/components';
import Sidebar from '../components/Sidebar.astro';
import NavLink from '../components/NavLink.astro';

interface Props {
  title: string;
}

const { title } = Astro.props;
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body>
    <div class="-translate-x-full transform-none overflow-hidden"></div>
    <button
      id="sidebar-button"
      type="button"
      class="ms-3 mt-2 inline-flex items-center rounded-lg p-2 text-sm text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 sm:hidden dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600">
      <span class="sr-only">Open sidebar</span>
      <Icon class="h-6 w-6" name="hamburger-menu" />
    </button>

    <Sidebar>
      <NavLink to="/" icon="mdi:chart-pie">Dashboard</NavLink>
      <NavLink to="#" icon="mdi:users">Users</NavLink>
      <NavLink to="/machines" icon="mdi:games">Arcade machines</NavLink>
      <NavLink to="#" icon="mdi:login">Sign in</NavLink>
    </Sidebar>

    <div id="container" class="h-full p-4 sm:ml-64">
      <slot />
    </div>
  </body>
</html>

<script>
  let bodyhandler: (this: HTMLBodyElement) => void;
  const container = document.querySelector('#container')!;
  const button = document.querySelector('#sidebar-button')!;
  const sidebar = document.querySelector('#sidebar')!;

  button.addEventListener('click', function (this: HTMLButtonElement) {
    document.body.classList.add('overflow-hidden');
    sidebar.classList.remove('-translate-x-full');
    sidebar.classList.add('transform-none');

    bodyhandler = function (this: HTMLBodyElement) {
      document.body.classList.remove('overflow-hidden');
      sidebar.classList.remove('transform-none');
      sidebar.classList.add('-translate-x-full');
      container.removeEventListener('click', bodyhandler);
    };
    container.addEventListener('click', bodyhandler);
  });
</script>

<style lang="scss" is:global>
  html {
    font-family: system-ui, sans-serif;
  }
  html,
  body {
    height: 100%;
  }
</style>
